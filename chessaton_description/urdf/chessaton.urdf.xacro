<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" 
    xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor"
    xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller"
    xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface"
    name="chessaton">

    <xacro:include filename="$(find chessaton_description)/urdf/chessaton_include.xacro" />
    <xacro:include filename="$(find chessaton_description)/urdf/chessaton_gazebo.xacro" />
    <xacro:include filename="$(find chessaton_description)/urdf/chessaton.ros2_control" />
    <xacro:include filename="$(find chessaton_description)/urdf/chessaton_hand.xacro" />
    <xacro:include filename="$(find chessaton_description)/urdf/sensors/camera.urdf.xacro" />

    <!--            -->
    <!-- Parameters -->
    <!--            -->
    <!-- Name of the robot (mandatory) -->
    <xacro:arg name="name" default="chessaton"/>
    <!-- Prefix for all entities -->
    <xacro:arg name="prefix" default="chessaton_"/>
    <!-- Flag to enable default gripper -->
    <xacro:arg name="gripper" default="true" />
    <xacro:arg name="virtual_dof" default="true" />
    <!-- Flag to enable camera -->
    <xacro:arg name="use_camera" default="false" />
    <!-- ros2_control -->
    <!-- Flag to enable ros2 controllers for manipulator -->
    <xacro:arg name="ros2_control" default="true"/>
    <!-- The ros2_control plugin that should be loaded for the manipulator ('fake', 'gz', 'real' or custom) -->
    <xacro:arg name="ros2_control_plugin" default="gz"/>
    <!-- The output control command interface provided by ros2_control ('position', 'velocity', 'effort' or certain combinations 'position,velocity') -->
    <xacro:arg name="ros2_control_command_interface" default="position"/>
    <!-- The filepath to parameters of ROS 2 controllers -->
    <xacro:arg name="ros2_controller_parameters" default="$(find chessaton_description)/config/controllers_$(arg ros2_control_command_interface).yaml"/>
    <!-- Flag to preserve fixed joints and prevent lumping when generating SDF for Gazebo -->
    <xacro:arg name="gazebo_preserve_fixed_joint" default="false"/>


    <link name="world"></link>

    <joint name="virtual_joint" type="fixed">
        <origin xyz="0 0 0" rpy="0 0 0" />
        <parent link="world" />
        <child link="chessaton_link0" />
    </joint>

    <link name="chessaton_link0">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
              <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link0.STL" />
            </geometry>
            <material name="color_link0" />
        </visual>
    
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link0.STL" />
          </geometry>
        </collision>

        <inertial>
            <origin xyz="-0.050129 -0.010271 0.035819" rpy="0 0 0" />
            <mass value="0.17447" />
            <inertia
                ixx="0.00011969"
                ixy="1.6753E-09"
                ixz="4.5328E-07"
                iyy="0.00034675"
                iyz="-4.0946E-09"
                izz="0.00045331" />
        </inertial> 
    </link>

    <joint name="chessaton_joint1" type="revolute">
        <origin xyz="0 0 0.08094" rpy="0 0 0" />
        <parent link="chessaton_link0" />
        <child link="chessaton_link1" />
        <axis xyz="0 0 -1" />
		<dynamics damping="0.5" friction="0.0" />
        <limit lower="${-pi/2}" upper="${pi/2}" effort="0" velocity="5" />
    </joint>

    <link name="chessaton_link1">
        <visual>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link1.STL" />
          </geometry>
          <material name="color_link1" />
        </visual>

        <collision>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link1.STL" />
          </geometry>
        </collision>

        <inertial>
            <origin xyz="0.012052 -0.0041948 0.012838" rpy="0 0 0" />
            <mass value="0.046511" />
            <inertia
              ixx="7.7123E-06"
              ixy="-4.0766E-09"
              ixz="1.6732E-09"
              iyy="1.046E-05"
              iyz="4.5327E-07"
              izz="1.4407E-05" />
        </inertial>
    </link>

	<joint name="chessaton_joint2" type="revolute">
		<origin xyz="0.022104 0.022723 0.015309" rpy="0 0 0" />
		<parent link="chessaton_link1" />
		<child link="chessaton_link2" />
		<axis xyz="0 -1 0" />
		<dynamics damping="0.5" friction="0.0" />
		<limit lower="${-pi/2}" upper="${pi/2}" effort="0" velocity="5" />
	</joint>

    <link name="chessaton_link2">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
              <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link2.STL" />
            </geometry>
            <material name="color_link2" />
        </visual>

        <inertial>
            <origin xyz="-6.8198E-09 -0.0253 0.093503" rpy="0 0 0" />
            <mass value="0.070955" />
            <inertia
              ixx="6.1321E-05"
              ixy="7.7897E-20"
              ixz="4.4464E-12"
              iyy="3.639E-05"
              iyz="-5.6971E-19"
              izz="3.1036E-05" />
        </inertial>

        <collision>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link2.STL" />
          </geometry>
        </collision>
    </link>

	<joint name="chessaton_joint3" type="revolute">
	  	<origin xyz="0 0 0.18701" rpy="0 0 0" />
	  	<parent link="chessaton_link2" />
	  	<child link="chessaton_link3" />
	  	<axis xyz="0 -1 0" />
	  	<dynamics damping="0.5" friction="0.0" />
	  	<limit lower="${-pi/2}" upper="${pi/2}" effort="0" velocity="6" />
	</joint>

	<link name="chessaton_link3">
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link3.STL" />
		  </geometry>
		  <material name="color_link3" />
		</visual>

		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link3.STL" />
		  </geometry>
		</collision>

		<inertial>
            <origin xyz="0.061953 -0.024546 -0.0017072" rpy="0 0 0" />
            <mass value="0.099802" />
            <inertia
              ixx="2.455E-05"
              ixy="6.6798E-10"
              ixz="-2.7683E-07"
              iyy="3.4978E-05"
              iyz="4.5265E-07"
              izz="5.1335E-05" />
        </inertial>
	</link>

	<joint name="chessaton_joint4" type="revolute">
	    <origin xyz="0.17811 0.0028273 9.1141E-05" rpy="0 0 0" />
	    <parent link="chessaton_link3" />
	    <child link="chessaton_link4" />
	    <axis xyz="0 -1 0" />
		<dynamics damping="0.5" friction="0.0" />
	    <limit lower="${-pi/2}" upper="${pi/2}" effort="0" velocity="6" />
	</joint>

	<link name="chessaton_link4">
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link4.STL" />
		  </geometry>
		  <material name="color_link4" />
		</visual>

		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link4.STL" />
		  </geometry>
		</collision>

        <inertial>
            <origin xyz="0.00247132842176606 -0.0269174421054227 -0.0100525933944812" rpy="0 0 0" />
            <mass value="0.0466425419935174" />
            <inertia
              ixx="1.4406877106279E-05"
              ixy="-4.53266983583288E-07"
              ixz="-1.6729067017079E-09"
              iyy="1.04604416782095E-05"
              iyz="-4.07637977779482E-09"
              izz="7.71225534218515E-06" />
        </inertial>
	</link>

	<joint name="gripper_joint" type="fixed">
	  <origin xyz="0.070609 -0.033634 -0.0087075" rpy="0 0 0" />
	  <parent link="chessaton_link4" />
	  <child link="chessaton_gripper" />
	  <axis xyz="0 0 0" />
	</joint>

    <xacro:chessaton_hand
        virtual_dof="$(arg virtual_dof)"
    />

    <xacro:if value="$(arg use_camera)">
        <xacro:sensor_camera /> 
    </xacro:if>

      <!-- Transmission macro -->
  <!-- <xacro:macro name="SimpleTransmissionPosition" params="joint n">
    <transmission name="tran${n}">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${joint}">
        <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      </joint>
      <actuator name="motor${n}">
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro> -->

  <!-- Transmission macro -->
  <!-- <xacro:macro name="SimpleTransmissionEffort" params="joint n">
    <transmission name="tran${n}">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${joint}">
        <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      </joint>
      <actuator name="motor${n}">
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro> -->

  <!-- <xacro:SimpleTransmissionEffort n="1" joint="chessaton_joint1" />

  <xacro:SimpleTransmissionEffort n="2" joint="chessaton_joint2" />

  <xacro:SimpleTransmissionEffort n="3" joint="chessaton_joint3" />

  <xacro:SimpleTransmissionEffort n="4" joint="chessaton_joint4" />

  <xacro:SimpleTransmissionEffort n="5" joint="left_finger_joint" />

  <xacro:SimpleTransmissionEffort n="6" joint="right_finger_joint" /> -->

    <xacro:gz_ros2_control
        ros2_controller_parameters="$(arg ros2_controller_parameters)"
    />

    <xacro:mein_ros2_control
        ros2_control="$(arg ros2_control)"
        prefix="$(arg prefix)" 
        ros2_control_plugin="$(arg ros2_control_plugin)"
        ros2_control_command_interface="$(arg ros2_control_command_interface)"
        ros2_controller_parameters="$(arg ros2_controller_parameters)"
    />

</robot>