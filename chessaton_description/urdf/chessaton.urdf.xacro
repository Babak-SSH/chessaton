<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" 
    xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor"
    xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller"
    xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface"
    name="chessaton">

    <xacro:include filename="$(find chessaton_description)/urdf/chessaton_include.xacro" />
    <xacro:include filename="$(find chessaton_description)/urdf/chessaton_gazebo.xacro" />
    <xacro:include filename="$(find chessaton_description)/urdf/chessaton.ros2_control" />

    <!--            -->
    <!-- Parameters -->
    <!--            -->
    <!-- Name of the robot (mandatory) -->
    <xacro:arg name="name" default="chessaton"/>
    <!-- Prefix for all entities -->
    <xacro:arg name="prefix" default="chessaton_"/>

    <!-- Flag to enable default gripper -->
    <xacro:arg name="gripper" default="true" />
    <!-- ros2_control -->
    <!-- Flag to enable ros2 controllers for manipulator -->
    <xacro:arg name="ros2_control" default="true"/>
    <!-- The ros2_control plugin that should be loaded for the manipulator ('fake', 'gz', 'real' or custom) -->
    <xacro:arg name="ros2_control_plugin" default="gz"/>
    <!-- The output control command interface provided by ros2_control ('position', 'velocity', 'effort' or certain combinations 'position,velocity') -->
    <xacro:arg name="ros2_control_command_interface" default="position"/>
    <!-- The filepath to parameters of ROS 2 controllers -->
    <xacro:arg name="ros2_controller_parameters" default="$(find chessaton_description)/config/controllers_$(arg ros2_control_command_interface).yaml"/>

    <!-- Flag to preserve fixed joints and prevent lumping when generating SDF for Gazebo -->
    <xacro:arg name="gazebo_preserve_fixed_joint" default="false"/>


    <link name="world"></link>

    <joint name="virtual_joint" type="fixed">
        <origin xyz="0 0 0" rpy="0 0 0" />
        <parent link="world" />
        <child link="chessaton_link0" />
    </joint>

    <link name="chessaton_link0">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
              <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link0.STL" />
            </geometry>
            <material name="color_link0" />
        </visual>
    
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link0.STL" />
          </geometry>
        </collision>

        <inertial>
            <origin xyz="-0.00073528 0.0040282 0.031188" rpy="0 0 0" />
            <mass value="0.094842" />
            <inertia
              ixx="3.0463E-05"
              ixy="-6.3087E-09"
              ixz="4.236E-07"
              iyy="4.8143E-05"
              iyz="-8.1925E-08"
              izz="5.1511E-05" />
        </inertial> 
    </link>

    <joint name="chessaton_joint1" type="revolute">
        <origin xyz="0.00015368 0.01229 0.07705" rpy="0 0 0" />
        <parent link="chessaton_link0" />
        <child link="chessaton_link1" />
        <axis xyz="0 0 -1" />
		<dynamics damping="1.0" friction="1.0" />
        <limit lower="${-pi}" upper="${pi}" effort="0" velocity="5" />
    </joint>

    <link name="chessaton_link1">
        <visual>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link1.STL" />
          </geometry>
          <material name="color_link1" />
        </visual>

        <collision>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link1.STL" />
          </geometry>
        </collision>

        <inertial>
            <origin xyz="0.012256 -0.0045169 0.011915" rpy="0 0 0" />
            <mass value="0.047535" />
            <inertia
              ixx="8.1555E-06"
              ixy="-8.4986E-08"
              ixz="1.6429E-09"
              iyy="1.0365E-05"
              iyz="4.236E-07"
              izz="1.4637E-05" />
        </inertial>
    </link>

	<joint name="chessaton_joint2" type="revolute">
		<origin xyz="0.022504 0.022833 0.013792" rpy="0 0 0" />
		<parent link="chessaton_link1" />
		<child link="chessaton_link2" />
		<axis xyz="0 -1 0" />
		<dynamics damping="1.0" friction="1.0" />
		<limit lower="${-pi/2}" upper="${pi/2}" effort="0" velocity="5" />
	</joint>

    <link name="chessaton_link2">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
              <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link2.STL" />
            </geometry>
            <material name="color_link2" />
        </visual>

        <inertial>
            <origin xyz="1.94289029309402E-16 -0.0247721366408157 0.0510000000000001" rpy="0 0 0" />
            <mass value="0.045902162826317" />
            <inertia
              ixx="4.65002565093796E-05"
              ixy="2.26509482575262E-19"
              ixz="1.10875380838109E-14"
              iyy="2.11429163261091E-05"
              iyz="-2.47808875423641E-23"
              izz="3.01847862586687E-05" />
        </inertial>

        <collision>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link2.STL" />
          </geometry>
        </collision>
    </link>

	<joint name="chessaton_joint3" type="revolute">
	  	<origin xyz="0 0 0.102" rpy="0 0 0" />
	  	<parent link="chessaton_link2" />
	  	<child link="chessaton_link3" />
	  	<axis xyz="0 -1 0" />
	  	<dynamics damping="1.0" friction="1.0" />
	  	<limit lower="${-pi/2}" upper="${pi/2}" effort="0" velocity="6" />
	</joint>

	<link name="chessaton_link3">
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link3.STL" />
		  </geometry>
		  <material name="color_link3" />
		</visual>

		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link3.STL" />
		  </geometry>
		</collision>

		<inertial>
            <origin xyz="0.030212 -0.026096 -0.0011497" rpy="0 0 0" />
            <mass value="0.076498" />
            <inertia
              ixx="2.3983E-05"
              ixy="7.4374E-08"
              ixz="-3.21E-07"
              iyy="2.2146E-05"
              iyz="4.236E-07"
              izz="3.9025E-05" />
        </inertial>
	</link>

	<joint name="chessaton_joint4" type="revolute">
	    <origin xyz="0.098504 0.00041731 0.0019578" rpy="0 0 0" />
	    <parent link="chessaton_link3" />
	    <child link="chessaton_link4" />
	    <axis xyz="0 -1 0" />
		<dynamics damping="1.0" friction="1.0" />
	    <limit lower="${-pi/2}" upper="${pi/2}" effort="0" velocity="6" />
	</joint>

	<link name="chessaton_link4">
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link4.STL" />
		  </geometry>
		  <material name="color_link4" />
		</visual>

		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/chessaton_link4.STL" />
		  </geometry>
		</collision>

        <inertial>
            <origin xyz="0.0016488 -0.027436 -0.0097099" rpy="0 0 0" />
            <mass value="0.046643" />
            <inertia
              ixx="1.458E-05"
              ixy="-4.236E-07"
              ixz="-1.6429E-09"
              iyy="1.0335E-05"
              iyz="-8.4986E-08"
              izz="8.1259E-06" />
        </inertial>
	</link>

	<joint name="gripper_joint" type="fixed">
	  <origin xyz="0.072842 -0.034194 -0.0048547" rpy="0 0 0" />
	  <parent link="chessaton_link4" />
	  <child link="chessaton_gripper" />
	  <axis xyz="0 0 0" />
	</joint>

	<link name="chessaton_gripper">
		<visual>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry>
			  <mesh filename="file://$(find chessaton_description)/meshes/chessaton_gripper.STL" />
			</geometry>
			<material name="color_gripper" />
		</visual>

		<collision>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry>
				<mesh filename="file://$(find chessaton_description)/meshes/chessaton_gripper.STL" />
			</geometry>
		</collision>

        <inertial>
            <origin xyz="-0.027242 0.0063062 -0.003963" rpy="0 0 0" />
            <mass value="0.07416" />
            <inertia
              ixx="2.5968E-05"
              ixy="8.488E-08"
              ixz="-4.236E-07"
              iyy="1.3082E-05"
              iyz="-1.6429E-09"
              izz="2.6136E-05" />
        </inertial>
	</link>

	<joint name="left_finger_joint" type="prismatic">
		<origin xyz="0 0 0" rpy="0 0 0" />
		<parent link="chessaton_gripper" />
		<child link="left_finger" />
		<axis xyz="0 1 0" />
		<dynamics damping="1.0" friction="1.0" />
		<limit lower="0" upper="0.03" effort="100" velocity="0.2" />
	</joint>

	<link name="left_finger">
    	<visual>
    	  <origin xyz="0 0 0" rpy="0 0 0" />
    	  <geometry>
    	    <mesh filename="file://$(find chessaton_description)/meshes/left_finger.STL" />
    	  </geometry>
    	  <material name="color_gripper_lfinger" />
    	</visual>

    	<collision>
    	  <origin xyz="0 0 0" rpy="0 0 0" />
    	  <geometry>
    	    <mesh filename="file://$(find chessaton_description)/meshes/left_finger.STL" />
    	  </geometry>
    	</collision>

        <inertial>
            <origin
              xyz="0.011394 0.0086324 -0.005"
              rpy="0 0 0" />
            <mass
              value="0.0088" />
            <inertia
              ixx="6.0646E-07"
              ixy="1.4141E-07"
              ixz="2.4551E-21"
              iyy="9.0397E-07"
              iyz="-6.5992E-22"
              izz="8.4377E-07" />
        </inertial>
	</link>

	<joint name="right_finger_joint" type="prismatic">
		<origin xyz="0 0 0" rpy="0 0 0" />
		<parent link="chessaton_gripper" />
		<child link="right_finger" />
		<axis xyz="0 1 0" />
		<dynamics damping="1.0" friction="1.0" />
		<limit lower="-0.03" upper="0" effort="100" velocity="0.2" />
	</joint>

	<link name="right_finger">
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/right_finger.STL" />
		  </geometry>
		  <material name="color_gripper_rfinger" />
		</visual>

		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
		    <mesh filename="file://$(find chessaton_description)/meshes/right_finger.STL" />
		  </geometry>
		</collision>
        <inertial>
            <origin xyz="0.011394 -0.0086324 -0.005" rpy="0 0 0" />
            <mass value="0.0088" />
            <inertia
              ixx="6.0646E-07"
              ixy="-1.4141E-07"
              ixz="1.2142E-21"
              iyy="9.0397E-07"
              iyz="7.2151E-22"
              izz="8.4377E-07" />
        </inertial>
	</link>

    <xacro:gz_ros2_control
        ros2_controller_parameters="$(arg ros2_controller_parameters)"
    />

    <xacro:mein_ros2_control
        ros2_control="$(arg ros2_control)"
        prefix="$(arg prefix)" 
        ros2_control_plugin="$(arg ros2_control_plugin)"
        ros2_control_command_interface="$(arg ros2_control_command_interface)"
        ros2_controller_parameters="$(arg ros2_controller_parameters)"
    />

</robot>